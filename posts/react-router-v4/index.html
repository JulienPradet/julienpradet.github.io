<!doctype html><html lang="fr" data-reactroot="" data-reactid="1" data-react-checksum="1715793534"><head data-reactid="2"><title data-react-helmet="true">React Router V4 | Julien Pradet</title><meta data-react-helmet="true" charset="utf-8"/><meta data-react-helmet="true" http-equiv="X-UA-Compatible" content="IE=edge"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1"/><meta data-react-helmet="true" name="description" content="La librairie la moins concurrencée de l&#x27;écosystème React se refond. Cette fois elle embrasse totalement l&#x27;esprit React. Pourquoi c&#x27;est cool ?"/><meta data-react-helmet="true" name="theme-color" content="#00C9C9"/><meta data-react-helmet="true" property="twitter:site" content="@JulienPradet"/><meta data-react-helmet="true" property="twitter:card" content="summary"/><meta data-react-helmet="true" property="twitter:creator" content="@JulienPradet"/><meta data-react-helmet="true" property="twitter:title" content="React Router V4"/><meta data-react-helmet="true" property="twitter:description" content="La librairie la moins concurrencée de l&#x27;écosystème React se refond. Cette fois elle embrasse totalement l&#x27;esprit React. Pourquoi c&#x27;est cool ?"/><meta data-react-helmet="true" property="twitter:image" content="https://pbs.twimg.com/profile_images/424964348461600768/aygHDGpF.png"/><meta data-react-helmet="true" property="og:site_name" content="Enchanté, Julien Pradet"/><meta data-react-helmet="true" property="og:type" content="page"/><meta data-react-helmet="true" property="og:title" content="React Router V4"/><meta data-react-helmet="true" property="og:url" content="https://www.julienpradet.fr/posts/react-router-v4/"/><meta data-react-helmet="true" property="og:image" content="https://pbs.twimg.com/profile_images/424964348461600768/aygHDGpF.png"/><meta data-react-helmet="true" property="og:description" content="La librairie la moins concurrencée de l&#x27;écosystème React se refond. Cette fois elle embrasse totalement l&#x27;esprit React. Pourquoi c&#x27;est cool ?"/><link data-react-helmet="true" rel="canonical" href="https://www.julienpradet.fr/posts/react-router-v4/"/><link data-react-helmet="true" rel="preload" href="/css/main.css" as="style"/><link data-react-helmet="true" rel="stylesheet" href="/css/main.css"/><link data-react-helmet="true" rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/><link data-react-helmet="true" rel="icon" href="/favicon.ico" type="image/x-icon"/><link data-react-helmet="true" rel="manifest" href="/manifest.json"/></head><body data-reactid="3"><div id="root" data-reactid="4"><div data-reactroot="" data-reactid="1" data-react-checksum="690688650"><!-- react-empty: 2 --><!-- react-empty: 3 --><!-- react-empty: 4 --><!-- react-empty: 5 --><!-- react-empty: 6 --><!-- react-empty: 7 --><!-- react-empty: 8 --><div class="page" data-reactid="9"><script data-reactid="10">window.location.href = "https://www.julienpradet.fr/posts/react-router-v4/"</script><!-- react-empty: 11 --><div data-reactid="12"><div class="page-header" data-reactid="13"><h1 data-reactid="14"><a href="/" data-reactid="15">React Router V4</a></h1><header data-reactid="16"><time data-reactid="17">Friday, February 3, 2017</time></header></div><div class="info" data-reactid="18"><!-- react-text: 19 -->Attention, j&#x27;ai changé d&#x27;hébergement. Ca se passe maintenant sur <!-- /react-text --><a href="https://www.julienpradet.fr" data-reactid="20">https://www.julienpradet.fr</a><!-- react-text: 21 -->. :)<!-- /react-text --><div style="margin-top:0.5em;" data-reactid="22"><a href="https://www.julienpradet.fr/posts/react-router-v4/" data-reactid="23">Accéder à l&#x27;article sur le nouvel hébergement.</a></div></div><div class="page-content" data-reactid="24"><div data-reactid="25"><div data-reactid="26"><p><a href="https://github.com/ReactTraining/react-router">React Router</a> est une librairie qui affiche vos composants en fonction de l'URL de votre navigateur. En gros, c'est indispensable si vous voulez faire une <abbr title="Single Page Application">SPA</abbr> et que vous voulez que l'utilisateur puisse croire que c'est un site normal qu'il peut partager, bookmarker, etc.</p>
<p>C'est donc un composant essentiel de votre application qui devra gérer tous les cas de figure : <abbr title="Server Side Rendering">SSR</abbr>, Testing, Code Splitting, Authentification, etc. On est donc bien content quand une lib s'en charge pour nous.</p>
<p>A l'heure où j'écris cet article, la <a href="https://reacttraining.com/react-router/">v4</a> est en <em>beta</em>. Cependant, j'utilise déjà depuis un moment la v4 <em>alpha</em> sur mes projets persos. Sûrement parce que je suis un <strong>#coolkid</strong> mais surtout parce qu'elle me paraît plus intuitive et s'incorpore mieux dans les projets React. C'est ce que je vais essayer de détailler dans cet article.</p>
<h3 id="comment-cetait-avant"><a class="header-anchor" href="#comment-cetait-avant" aria-hidden="true">#</a> Comment c'était avant ?</h3>
<p>Historiquement, la lib est inspirée par le Router de <a href="http://emberjs.com/">Ember</a> et a été créée par <a href="https://twitter.com/ryanflorence">Ryan Florence</a> et <a href="https://twitter.com/mjackson">Michael Jackson</a>. En haut de votre application, vous définissiez l'ensemble des routes qui constituent votre application et le Router se débrouille pour afficher les bons composants au bon moment.</p>
<p>Concrètement, ça ressemblait à ça :</p>
<pre class="language-jsx"><code>ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Router</span> <span class="token attr-name">history</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>browserHistory<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Route</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>/<span class="token punctuation">'</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>Layout<span class="token punctuation">}</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IndexRoute</span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>Home<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Route</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>about<span class="token punctuation">'</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>About<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Route</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>:article<span class="token punctuation">'</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>Article<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Route</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Router</span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
  domElement
<span class="token punctuation">)</span>
</code></pre>
<p>En prenant cette configuration de routes, si vous êtes sur l'url <code>/</code>, c'est comme si vous aviez écrit :</p>
<pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Layout</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Home</span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Layout</span><span class="token punctuation">></span></span>
</code></pre>
<p>Si vous êtes sur <code>/super-article-qu-il-faut-partager</code>, ce serait plutôt :</p>
<pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Layout</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Article</span> <span class="token attr-name">params</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
    article<span class="token punctuation">:</span> <span class="token string">'super-article-qu-il-faut-partager'</span>
  <span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Layout</span><span class="token punctuation">></span></span>
</code></pre>
<p>Ca marchait plutôt bien en vrai. Mais les créateurs de la librairie ont décidé de tout changer. Oh les vilains !</p>
<h3 id="maintenant-cest-comment"><a class="header-anchor" href="#maintenant-cest-comment" aria-hidden="true">#</a> Maintenant c'est comment ?</h3>
<p>Si on veut transformer l'exemple des routes du dessus, en pratique cela ressemblerait à ça :</p>
<pre class="language-jsx"><code>ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BrowserRouter</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Layout</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Switch</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Route</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>/<span class="token punctuation">'</span></span> <span class="token attr-name">render</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Home</span> <span class="token punctuation">/></span></span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Route</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>/about<span class="token punctuation">'</span></span> <span class="token attr-name">render</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>About</span> <span class="token punctuation">/></span></span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Route</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>/:article<span class="token punctuation">'</span></span> <span class="token attr-name">render</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">{</span> match <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>Article id<span class="token punctuation">=</span><span class="token punctuation">{</span>match<span class="token punctuation">.</span>params<span class="token punctuation">.</span>article<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Switch</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Layout</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BrowserRouter</span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
  domElement
<span class="token punctuation">)</span>
</code></pre>
<p>Ce n'est pas très impressionnant et n'apporte pas beaucoup de valeur. En gros, pour faire cette transformation, on a :</p>
<ul>
<li>mis <code>Layout</code> directement dans le <code>ReactDOM.render</code> plutôt que dans une route</li>
<li>entouré les routes filles dans un <a href="https://reacttraining.com/react-router/#switch"><code>Switch</code></a></li>
<li>et changé un peu l'API des routes (en vrai, vous pourriez rester sur la propriété <a href="https://reacttraining.com/react-router/#route.component"><code>component</code></a>, mais j'aime beaucoup ce <code>render</code>)</li>
</ul>
<p>Voilà, vous savez migrer vers la v4.</p>
<h3 id="et-en-vrai-cest-quoi-la-difference"><a class="header-anchor" href="#et-en-vrai-cest-quoi-la-difference" aria-hidden="true">#</a> Et en vrai, c'est quoi la différence ?</h3>
<p>Parce que casser des APIs uniquement pour le plaisir, c'est pas franchement cool.</p>
<h4 id="peu-importe-la-position-des-routes"><a class="header-anchor" href="#peu-importe-la-position-des-routes" aria-hidden="true">#</a> Peu importe la position des Routes</h4>
<p>La première chose, c'est que les <code>Routes</code> peuvent être utilisées dans n'importe quel composant.</p>
<p>Ainsi, si <code>/:article</code> devait avoir les sous-routes <code>/:article/read</code> et <code>/:article/comment</code>, vous pourriez les définir directement dans le composant <code>Article</code> plutôt que de devoir le faire à la racine de votre application. Résultat : Vous pouvez enfin réellement découper votre application en mini-applications.</p>
<blockquote>
<p><em>– Oulah, ça va fait des spaghettis ça !</em></p>
</blockquote>
<p>Non. La peur du spaghetti vient du fait qu'on ne connait pas d'avance la structure globale de l'ensemble de l'application. Mais quand on fait du React, <strong>le but n'est pas de faire une <em>grosse</em> application, mais plein de <em>petites</em> applications</strong>. D'une part, c'est plus facile de raisonner ainsi parce qu'il n'y a plus besoin de connaître tous les rouages pour savoir ce qu'on peut casser avec nos modifications. D'autre part on accède au graal du mode <code>plug-n-play</code> : pour rajouter toute la gestion des articles il n'y a qu'une <code>Route</code> à ajouter.</p>
<p>De plus, cela simplifie la gestion des besoins avancés tels que le <abbr title="Hot Module Replacement">HMR</abbr> (même si je n'en ressens pas le besoin sur des applications avec Router), le SSR, le Code Splitting, etc.</p>
<h4 id="autant-de-routes-que-lon-veut"><a class="header-anchor" href="#autant-de-routes-que-lon-veut" aria-hidden="true">#</a> Autant de Routes que l'on veut</h4>
<p>Avant, le Router choisissait à votre place la route affichée. La première qui <em>matchait</em> était élue grande gagnante et avait l'honneur d'apparaître sur votre page. Dorénavant, si vous enlevez le <code>Switch</code> et qu'une route <em>match</em> elle est affichée, y compris si celle au-dessus <em>match</em> aussi.</p>
<p>Concrètement, si j'utilise ce bout de code, et que je vais sur l'URL <code>/about</code>, qu'est ce qui est affiché ?</p>
<pre class="language-jsx"><code>ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BrowserRouter</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Layout</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Route</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>/<span class="token punctuation">'</span></span> <span class="token attr-name">render</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Home</span> <span class="token punctuation">/></span></span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Route</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>/about<span class="token punctuation">'</span></span> <span class="token attr-name">render</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>About</span> <span class="token punctuation">/></span></span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Route</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>/:article<span class="token punctuation">'</span></span> <span class="token attr-name">render</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">{</span> match <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">&lt;</span>Article id<span class="token punctuation">=</span><span class="token punctuation">{</span>match<span class="token punctuation">.</span>params<span class="token punctuation">.</span>article<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Layout</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BrowserRouter</span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
  domElement
<span class="token punctuation">)</span>
</code></pre>
<ul>
<li><code>Home</code> va matcher étant donné que l'url commence par <code>/</code></li>
<li><code>About</code> aussi vu que c'est exactement cette URL que l'on utilise</li>
<li><code>Article</code> aussi avec <code>&quot;about&quot;</code> pour <code>id</code> .</li>
</ul>
<p>Je ne vous cache pas que pour le coeur des <code>Routes</code>, c'est embêtant. Mais depuis que la <em>beta</em> est là, <a href="https://reacttraining.com/react-router/#switch"><code>Switch</code></a> permet de répondre à ce besoin.</p>
<p>Par contre, pour tout le reste, c'est absoluement génial. Grâce à ça vous pouvez par exemple gérer votre menu et sous-menus avec les Routes !</p>
<pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>
  <span class="token comment" spellcheck="true">// 1. La Route est tout le temps affichée</span>
  <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">'/super-article'</span> children<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">{</span>match<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>
    <span class="token comment" spellcheck="true">// 2. Affichage conditionnel</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>match <span class="token operator">&amp;&amp;</span> match<span class="token punctuation">.</span>isExact <span class="token operator">?</span> <span class="token string">'active'</span> <span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span>
      <span class="token comment" spellcheck="true">// 3. Affichage permanent</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>/super-article<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>Mon Super Article<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Link</span><span class="token punctuation">></span></span>
      <span class="token comment" spellcheck="true">// 4. Affichage du sous-menu</span>
      <span class="token punctuation">{</span>match <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>/read<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>Lire<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Link</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>/comment<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>Commenter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Link</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>

  <span class="token comment" spellcheck="true">// Possible de rajouter d'autres routes ici</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
</code></pre>
<ol>
<li>
<p><strong>La Route est tout le temps affichée</strong><br>
Le but est de tout le temps afficher le lien vers mon article. Pour cela, il y a la propriété <code>children</code> qui force l'affichage de la Route. Cependant, l'objet <code>match</code> ne sera définit que si la Route correspond à l'URL en cours d'affichage.</p>
</li>
<li>
<p><strong>Affichage conditionnel</strong><br>
Je peux jouer sur l'affichage de cet élément en fonction de l'URL en cours de visite. Ici, je l'ai fait avec une classe, mais on pourrait imaginer ajouter une mini description, etc. (<code>isExact</code> permet de faire en sorte que ce soit exactement cette URL et pas une sous-route.)</p>
</li>
<li>
<p><strong>Affichage permanent</strong><br>
Il faut que mon lien soit tout le temps affiché pour amener vers mon article.</p>
</li>
<li>
<p><strong>Affichage du sous-menu</strong><br>
Le sous-menu ne doit s'afficher que lorsque l'URL correspond. J'ai mis des liens en dur dans la liste, mais on pourrait imaginer de nouvelles Routes.</p>
</li>
</ol>
<p>Et le mieux dans tout ça, c'est que ce ne sont que des composants. Il est donc tout à fait possible de faire un composant qui simplifieras l'écriture finale :</p>
<pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MenuItem</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>/super-article<span class="token punctuation">'</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>Mon</span> <span class="token attr-name">Super</span> <span class="token attr-name">Article'</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>/read<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>Lire<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Link</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>/comment<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>Commenter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Link</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>MenuItem</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
</code></pre>
<p>Vous pourriez imaginer un comportement similaire pour un fil d'Ariane, des animations entre les pages, etc.</p>
<h3 id="quelques-bonnes-pratiques"><a class="header-anchor" href="#quelques-bonnes-pratiques" aria-hidden="true">#</a> Quelques bonnes pratiques</h3>
<p>Si vous avez décider de faire le pas, il y a quelques conseils que je pourrais vous donner avant de vous aventurer dans la migration.</p>
<h4 id="simplifier-lapi-en-la-cachant"><a class="header-anchor" href="#simplifier-lapi-en-la-cachant" aria-hidden="true">#</a> Simplifier l'API en la cachant</h4>
<p>C'est un conseil commun à tout composant en React. Cependant, j'en ai ressenti particulièrement le besoin sur mes Routes.</p>
<p>En effet, dorénavant, beaucoup plus de possibilités s'offrent à vous avec le Router. Vous allez donc avoir un code avec parfois des logiques un petit peu plus tordues (beaucoup de conditions d'affichage). Le but sera d'isoler cette logique dans un composant pour ne laisser que le strict minimum apparaître à la surface. C'est ce que je propose avec le <code>MenuItem</code> présenté plus haut.</p>
<h4 id="sefforcer-de-faire-des-liens-generiques"><a class="header-anchor" href="#sefforcer-de-faire-des-liens-generiques" aria-hidden="true">#</a> S'efforcer de faire des liens génériques</h4>
<p>Dans une route, l'objet <a href="https://reacttraining.com/react-router/#match"><code>match</code></a> qui est passée au composant affiché contient la propriété <code>url</code>. Quand vous faites des liens dans votre application, efforcez-vous d'utiliser cette propriété pour rendre vos liens plus générique.</p>
<p>Concrètement, cela veut dire que si je suis sur la Route <code>/article</code> et que je veux faire un lien vers <code>/article/read</code>, je vais écrire mon lien ainsi :</p>
<pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Link</span> <span class="token attr-name">to</span><span class="token script language-javascript"><span class="token punctuation">=</span><span class="token punctuation">{</span>match<span class="token punctuation">.</span>url <span class="token operator">+</span> <span class="token string">'/read'</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span>Lire<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Link</span><span class="token punctuation">></span></span>
</code></pre>
<p>En faisant cela, vous préserverez l'aspect <code>plug-n-play</code> de vos composants puisque s'ils changent d'URL de base, les liens fonctionneront toujours.</p>
<p>Si l'objet <code>match</code> est trop loin dans votre arbre de composant, vous pouvez toujours passer par le contexte avec <a href="https://reacttraining.com/react-router/#withrouter"><code>withRouter</code></a> qui contient lui aussi l'objet <code>match</code>.</p>
<h4 id="ne-plus-tester-lurl-ou-lhistory-et-nutiliser-que-des-composants"><a class="header-anchor" href="#ne-plus-tester-lurl-ou-lhistory-et-nutiliser-que-des-composants" aria-hidden="true">#</a> Ne plus tester l'URL ou l'history et n'utiliser que des composants</h4>
<p>Il serait en soit toujours possible de faire les mêmes hacks qu'avant en récupérant le contexte et jouant avec <code>history</code>. Cependant, les composants mis à disposition tels que <a href="https://reacttraining.com/react-router/#redirect"><code>Redirect</code></a> ou <a href="https://reacttraining.com/react-router/#prompt"><code>Prompt</code></a> serons sûrement mieux testés et plus générique que ce que vous ferriez. C'est vrai que c'est assez difficile de se faire à l'idée de mettre un Composant pour faire une action plutôt qu'un affichage, mais à l'utilisation, ça marche plutôt bien.</p>
<h4 id="tester-vos-composants"><a class="header-anchor" href="#tester-vos-composants" aria-hidden="true">#</a> Tester vos composants</h4>
<p>Si vous testez vos composants et que ceux-ci contiennent des <code>Links</code> ou des <code>Routes</code>, vous aurez un problème. Cependant, il existe un composant qui s'appelle <code>MemoryRouter</code> qui vous sauvera la mise. Il remplacera le <code>BrowserRouter</code> qui manquera dans vos tests.</p>
<h4 id="lire-la-doc"><a class="header-anchor" href="#lire-la-doc" aria-hidden="true">#</a> Lire la doc</h4>
<p><a href="https://reacttraining.com/react-router">La doc est très bien faite</a> et vous présente plein de cas qui vous permettrons d'explorer les possiblités qu'offre ce nouveau Router.</p>
<h3 id="prets-a-sauter-le-pas"><a class="header-anchor" href="#prets-a-sauter-le-pas" aria-hidden="true">#</a> Prêts à sauter le pas ?</h3>
<p>C'est toujours en beta, alors oui, ça fait peur.</p>
<p>Mais si vous commencez un nouveau projet, je vous conseille vivement de partir dessus. C'est toujours agréable de travailler avec des librairies qui vous apprennent des choses sans vous barrer la route <small>(héhé)</small>.</p>
<p>Si vous avez déjà du code en production, la migration sera peut-être un petit peu plus délicate. Cela dit, ils ont fait beaucoup d'efforts avec la beta pour faciliter cette étape.</p>
<p>En tout cas, si un point n'est pas clair ou si vous avez juste envie de commenter, n'hésitez pas à venir <a href="https://twitter.com/JulienPradet">me poser des questions</a>. :)</p>
<hr>
<p>Sources complémentaires :</p>
<ul>
<li><a href="https://github.com/ReactTraining/react-router">React Router - Github</a></li>
<li><a href="https://reacttraining.com/react-router">React Router V4 - Documentation</a></li>
</ul>
</div></div><hr data-reactid="27"/><div data-reactid="28"><footer class="page-footer" data-reactid="29"><!-- react-text: 30 -->Si vous voulez suivre mes publications, il paraît que j&#x27;ai un feed <!-- /react-text --><a href="/feed.xml" data-reactid="31">RSS</a><!-- react-text: 32 --> et un <!-- /react-text --><a href="https://twitter.com/JulienPradet" data-reactid="33">Twitter</a><!-- react-text: 34 -->.<!-- /react-text --><br data-reactid="35"/><!-- react-text: 36 -->Si vous pensez à d&#x27;autres méthodes que vous voudriez que je mette en place (pigeon voyageur, avion en papier, etc.), n&#x27;hésitez pas à me les proposer :)<!-- /react-text --></footer><hr data-reactid="37"/></div><div data-reactid="38"><h2 data-reactid="39">Les derniers articles</h2><ul class="page-list" data-reactid="40"><li class="page-list__item" data-reactid="41"><div class="page-preview" data-reactid="42"><a class="page-preview__title" href="/posts/des-animations-performantes-1" data-reactid="43">Des animations performantes - Partie 1</a><div class="page-preview__meta" data-reactid="44"><time data-reactid="45">Friday, February 17, 2017</time></div><div class="page-preview__description" data-reactid="46"><!-- react-text: 47 -->Faire des animations, c&#x27;est cool. Faire des animations qui ne lag pas, c&#x27;est mieux. Voici la première des trois techniques dont je vais vous parler.<!-- /react-text --><!-- react-text: 48 --> <!-- /react-text --></div><div class="page-preview__read-more" data-reactid="49"><a href="/posts/des-animations-performantes-1" data-reactid="50">Lire la suite →</a></div></div></li><li class="page-list__item" data-reactid="51"><div class="page-preview" data-reactid="52"><a class="page-preview__title" href="/posts/react-router-v4" data-reactid="53">React Router V4</a><div class="page-preview__meta" data-reactid="54"><time data-reactid="55">Friday, February 3, 2017</time></div><div class="page-preview__description" data-reactid="56"><!-- react-text: 57 -->La librairie la moins concurrencée de l&#x27;écosystème React se refond. Cette fois elle embrasse totalement l&#x27;esprit React. Pourquoi c&#x27;est cool ?<!-- /react-text --><!-- react-text: 58 --> <!-- /react-text --></div><div class="page-preview__read-more" data-reactid="59"><a href="/posts/react-router-v4" data-reactid="60">Lire la suite →</a></div></div></li></ul></div><a href="/" data-reactid="61">Revenir à la page d&#x27;accueil</a></div></div><footer class="footer" data-reactid="62"><ul data-reactid="63"><li data-reactid="64"><a href="https://twitter.com/JulienPradet" data-reactid="65"><span class="SVGInline SVGInline--cleaned" data-reactid="66"><svg class="SVGInline-svg SVGInline--cleaned-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 4.557a9.83 9.83 0 0 1-2.828.775 4.932 4.932 0 0 0 2.165-2.724 9.864 9.864 0 0 1-3.127 1.195 4.916 4.916 0 0 0-3.594-1.555c-3.18 0-5.515 2.966-4.797 6.045A13.978 13.978 0 0 1 1.67 3.15a4.93 4.93 0 0 0 1.524 6.573 4.903 4.903 0 0 1-2.23-.616c-.053 2.28 1.582 4.415 3.95 4.89a4.935 4.935 0 0 1-2.224.084 4.928 4.928 0 0 0 4.6 3.42A9.9 9.9 0 0 1 0 19.54a13.94 13.94 0 0 0 7.548 2.212c9.142 0 14.307-7.72 13.995-14.646A10.025 10.025 0 0 0 24 4.556z"/></svg></span><span class="name" data-reactid="67">@JulienPradet</span></a></li><li data-reactid="68"><a href="https://github.com/JulienPradet/blog-posts" data-reactid="69"><span class="SVGInline SVGInline--cleaned" data-reactid="70"><svg class="SVGInline-svg SVGInline--cleaned-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.6.11.793-.26.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.09-.745.083-.73.083-.73 1.205.085 1.84 1.238 1.84 1.238 1.07 1.834 2.806 1.304 3.49.997.108-.776.42-1.306.763-1.605-2.665-.305-5.467-1.334-5.467-5.93 0-1.312.47-2.382 1.236-3.222-.125-.303-.536-1.524.116-3.176 0 0 1.008-.322 3.3 1.23A11.51 11.51 0 0 1 12 5.803c1.02.005 2.047.138 3.006.404 2.29-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.236 1.91 1.236 3.22 0 4.61-2.807 5.625-5.48 5.922.43.372.824 1.102.824 2.222v3.293c0 .32.192.694.8.576C20.567 21.796 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg></span><span class="name" data-reactid="71">JulienPradet</span></a></li></ul></footer></div></div></div><script data-reactid="5">__REACT_ASYNC_COMPONENTS_STATE__ = {"resolved":{"1":true}}</script><script defer="" src="../../app.7bed6fc368b67c6b70dd.js" data-reactid="6"></script></body></html>